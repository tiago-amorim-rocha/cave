<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Caves">
  <meta name="theme-color" content="#1a1a1a">

  <title>Carvable Caves</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #fff;
    }

    #canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      touch-action: none;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #ui {
      position: fixed;
      top: env(safe-area-inset-top, 10px);
      left: env(safe-area-inset-left, 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      font-size: 14px;
      pointer-events: auto;
      max-width: 400px;
      z-index: 100;
    }

    #ui h1 {
      font-size: 18px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .control-group {
      margin-bottom: 12px;
    }

    .control-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
      color: #ccc;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #333;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
      border: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      touch-action: manipulation;
      pointer-events: auto;
      position: relative;
      z-index: 1;
      -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
      user-select: none;
      -webkit-user-select: none;
    }

    button:active {
      background: #45a049;
      transform: scale(0.98);
    }

    #stats {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      left: env(safe-area-inset-left, 10px);
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      color: #4CAF50;
      z-index: 100;
      pointer-events: none;
    }

    .stat-row {
      display: flex;
      gap: 15px;
    }

    .instructions {
      font-size: 12px;
      color: #888;
      margin-top: 10px;
      line-height: 1.5;
    }

    .value {
      color: #4CAF50;
      font-weight: 600;
    }

    #version {
      position: fixed;
      top: env(safe-area-inset-top, 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(255, 152, 0, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 11px;
      font-family: 'Courier New', monospace;
      color: #000;
      z-index: 10002;
      pointer-events: none;
      font-weight: bold;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    #update-button {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(76, 175, 80, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      font-size: 24px;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      pointer-events: auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      animation: pulse 2s ease-in-out infinite;
      -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    #update-button:active {
      background: rgba(69, 160, 73, 1);
      transform: scale(0.95);
    }

    #update-button.visible {
      display: flex;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 4px 16px rgba(76, 175, 80, 0.6);
      }
    }

    #debug-button {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      left: calc(env(safe-area-inset-left, 10px) + 150px);
      background: rgba(255, 152, 0, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      pointer-events: auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      -webkit-tap-highlight-color: rgba(255, 152, 0, 0.3);
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    #debug-button:active {
      background: rgba(245, 142, 0, 1);
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div id="ui">
    <h1>Carvable Caves</h1>

    <div class="control-group">
      <label>
        <span>Brush Radius (m)</span>
        <span class="value" id="brush-radius-value">2.0</span>
      </label>
      <input type="range" id="brush-radius" min="0.5" max="10" step="0.1" value="2">
    </div>

    <div class="control-group">
      <label>
        <span>Brush Strength</span>
        <span class="value" id="brush-strength-value">30</span>
      </label>
      <input type="range" id="brush-strength" min="10" max="100" step="5" value="30">
    </div>

    <div class="control-group">
      <button id="reset-button">Reset Cave</button>
    </div>

    <div class="instructions">
      <strong>Controls:</strong><br>
      ‚Ä¢ Tap/Click + Drag: Carve cave<br>
      ‚Ä¢ Hold Shift/Alt: Add rock<br>
      ‚Ä¢ Two-finger pinch: Zoom<br>
      ‚Ä¢ Right-click drag: Pan camera<br>
      ‚Ä¢ Mouse wheel: Zoom
    </div>
  </div>

  <div id="stats">
    <div class="stat-row">
      <span>FPS: <span id="fps-value">0</span></span>
      <span>MEM: <span id="memory-value">0</span> MB</span>
    </div>
  </div>

  <div id="version">Loading...</div>

  <button id="update-button" title="Update available! Click to reload">üîÑ</button>
  <button id="debug-button" title="Toggle debug console">üêõ</button>

  <script>
    // Immediately update version before anything else
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const mins = now.getMinutes().toString().padStart(2, '0');
    const secs = now.getSeconds().toString().padStart(2, '0');
    const version = 'v' + hours + mins + secs;
    document.getElementById('version').textContent = version;
    console.log('Version:', version, 'Time:', now.toISOString());
    console.log('Location:', window.location.href);
    console.log('Base URL:', document.baseURI);

    // Check if modules are supported
    const supportsModules = 'noModule' in HTMLScriptElement.prototype;
    console.log('ES Modules supported:', supportsModules);

    // Catch any errors
    window.onerror = function(msg, url, line, col, error) {
      const errorMsg = 'ERROR: ' + msg + '\nURL: ' + url + '\nLine: ' + line;
      alert(errorMsg);
      console.error('Global error:', msg, url, line, error);
      return false;
    };

    // Check if module loads
    setTimeout(() => {
      if (!window.APP_LOADED) {
        alert('Module failed to load!\nCheck console for details.');
        console.error('Module did not set window.APP_LOADED flag');
      }
    }, 3000);
  </script>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
