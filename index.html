<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Caves">
  <meta name="theme-color" content="#1a1a1a">

  <title>Procedural Caves</title>
  <!-- Auto-deploy test -->

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #fff;
    }

    #canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      touch-action: none;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #ui {
      position: fixed;
      top: env(safe-area-inset-top, 10px);
      left: env(safe-area-inset-left, 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      font-size: 14px;
      pointer-events: auto;
      max-width: 400px;
      z-index: 100;
    }

    #ui h1 {
      font-size: 18px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .control-group {
      margin-bottom: 12px;
    }

    .control-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
      color: #ccc;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #333;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
      border: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      touch-action: manipulation;
      pointer-events: auto;
      position: relative;
      z-index: 1;
      -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
      user-select: none;
      -webkit-user-select: none;
    }

    button:active {
      background: #45a049;
      transform: scale(0.98);
    }

    #stats {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      left: env(safe-area-inset-left, 10px);
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      color: #4CAF50;
      z-index: 100;
      pointer-events: none;
    }

    .stat-row {
      display: flex;
      gap: 15px;
    }

    .instructions {
      font-size: 12px;
      color: #888;
      margin-top: 10px;
      line-height: 1.5;
    }

    .value {
      color: #4CAF50;
      font-weight: 600;
    }

    #version {
      position: fixed;
      top: env(safe-area-inset-top, 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(255, 152, 0, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 11px;
      font-family: 'Courier New', monospace;
      color: #000;
      z-index: 10002;
      pointer-events: none;
      font-weight: bold;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    #update-button {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      right: env(safe-area-inset-right, 10px);
      background: rgba(76, 175, 80, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      font-size: 24px;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      pointer-events: auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      animation: pulse 2s ease-in-out infinite;
      -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    #update-button:active {
      background: rgba(69, 160, 73, 1);
      transform: scale(0.95);
    }

    #update-button.visible {
      display: flex;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 4px 16px rgba(76, 175, 80, 0.6);
      }
    }

    #debug-button {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 10px) + 10px);
      left: calc(env(safe-area-inset-left, 10px) + 150px);
      background: rgba(255, 152, 0, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      pointer-events: auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      -webkit-tap-highlight-color: rgba(255, 152, 0, 0.3);
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    #debug-button:active {
      background: rgba(245, 142, 0, 1);
      transform: scale(0.95);
    }

    /* Portrait mode overlay */
    #portrait-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      padding: 20px;
      text-align: center;
    }

    #portrait-overlay .rotate-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: rotate-pulse 2s ease-in-out infinite;
    }

    #portrait-overlay h2 {
      font-size: 24px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    #portrait-overlay p {
      font-size: 16px;
      color: #ccc;
      max-width: 300px;
    }

    @keyframes rotate-pulse {
      0%, 100% {
        transform: rotate(0deg) scale(1);
      }
      50% {
        transform: rotate(90deg) scale(1.1);
      }
    }

    /* Show overlay only in portrait mode */
    @media (orientation: portrait) {
      #portrait-overlay {
        display: flex;
      }

      /* Hide all other UI elements in portrait */
      #canvas, #ui, #stats, #version, #update-button, #debug-button, #simple-log {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <!-- Portrait mode warning -->
  <div id="portrait-overlay">
    <div class="rotate-icon">üì±</div>
    <h2>Please Rotate Your Device</h2>
    <p>This game is designed for landscape mode only. Please rotate your device to play.</p>
  </div>

  <canvas id="canvas"></canvas>

  <div id="ui">
    <h1>Cave Platformer</h1>

    <div class="control-group">
      <button id="reset-button">Generate New Cave</button>
    </div>

    <div class="control-group">
      <label style="cursor: pointer; user-select: none;">
        <span>
          <input type="checkbox" id="debug-grid" style="width: auto; margin-right: 8px;">
          Show Grid
        </span>
      </label>
      <label style="cursor: pointer; user-select: none;">
        <span>
          <input type="checkbox" id="debug-vertices" style="width: auto; margin-right: 8px;">
          Show Vertices
        </span>
      </label>
      <label style="cursor: pointer; user-select: none;">
        <span>
          <input type="checkbox" id="debug-physics" style="width: auto; margin-right: 8px;">
          Show Physics Bodies
        </span>
      </label>
      <label style="cursor: pointer; user-select: none;">
        <span>
          <input type="checkbox" id="debug-console-log" style="width: auto; margin-right: 8px;">
          Console Logging
        </span>
      </label>
    </div>

    <div class="instructions">
      <strong>Controls:</strong><br>
      ‚Ä¢ A/D or Arrow Keys: Move left/right<br>
      ‚Ä¢ W/Space: Jump<br>
      ‚Ä¢ Mouse wheel: Zoom<br>
      ‚Ä¢ Static camera (for debugging physics)
    </div>
  </div>

  <div id="stats">
    <div class="stat-row">
      <span>FPS: <span id="fps-value">0</span></span>
      <span>MEM: <span id="memory-value">0</span> MB</span>
    </div>
  </div>

  <div id="version">Loading...</div>

  <!-- Simple on-screen log (no module needed) -->
  <div id="simple-log" style="position: fixed; top: 50px; left: 10px; right: 10px; bottom: 10px; background: rgba(0,0,0,0.95); color: #0f0; font-family: monospace; font-size: 10px; padding: 10px; overflow-y: auto; z-index: 10003; border: 2px solid #0f0; display: none;"></div>

  <button id="update-button" title="Update available! Click to reload">üîÑ</button>
  <button id="debug-button" title="Toggle debug console">üêõ</button>

  <script>
    // Simple on-screen logger (hidden by default)
    const simpleLog = document.getElementById('simple-log');
    let simpleLogVisible = false;

    function log(msg) {
      const line = document.createElement('div');
      line.textContent = new Date().toLocaleTimeString() + ': ' + msg;
      simpleLog.appendChild(line);
      simpleLog.scrollTop = simpleLog.scrollHeight;
      console.log(msg);
    }

    // Make log available globally
    window.log = log;

    // Toggle simple log with debug button until app loads
    const debugBtn = document.getElementById('debug-button');
    if (debugBtn) {
      debugBtn.addEventListener('click', function() {
        if (!window.APP_LOADED) {
          simpleLogVisible = !simpleLogVisible;
          simpleLog.style.display = simpleLogVisible ? 'block' : 'none';
        }
      });
    }

    // Immediately update version before anything else
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const mins = now.getMinutes().toString().padStart(2, '0');
    const secs = now.getSeconds().toString().padStart(2, '0');
    const version = 'v' + hours + mins + secs;
    document.getElementById('version').textContent = version;
    log('Version: ' + version);
    log('Time: ' + now.toISOString());
    log('Location: ' + window.location.href);
    log('Base URL: ' + document.baseURI);

    // Check if modules are supported
    const supportsModules = 'noModule' in HTMLScriptElement.prototype;
    log('ES Modules supported: ' + supportsModules);

    // Catch any errors - auto-show simple log on error
    window.onerror = function(msg, url, line, col, error) {
      log('ERROR: ' + msg);
      log('URL: ' + url);
      log('Line: ' + line);
      simpleLog.style.display = 'block';
      simpleLogVisible = true;
      return false;
    };

    // Check if module loads
    setTimeout(() => {
      if (!window.APP_LOADED) {
        log('!!! MODULE FAILED TO LOAD !!!');
        log('The TypeScript module did not execute');
        log('This means the JS file is not loading from GitHub Pages');
        simpleLog.style.display = 'block';
        simpleLogVisible = true;
      } else {
        log('Module loaded successfully!');
        // Hide simple log after 1 second - DebugConsole takes over
        setTimeout(() => {
          simpleLog.style.display = 'none';
          simpleLogVisible = false;
        }, 1000);
      }
    }, 3000);

    log('--- Waiting for module to load... ---');
  </script>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
